(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e61ee47e"],{"02f4":function(t,e,a){var r=a("4588"),n=a("be13");t.exports=function(t){return function(e,a){var s,i,o=String(n(e)),c=r(a),l=o.length;return c<0||c>=l?t?"":void 0:(s=o.charCodeAt(c),s<55296||s>56319||c+1===l||(i=o.charCodeAt(c+1))<56320||i>57343?t?o.charAt(c):s:t?o.slice(c,c+2):i-56320+(s-55296<<10)+65536)}}},"0390":function(t,e,a){"use strict";var r=a("02f4")(!0);t.exports=function(t,e,a){return e+(a?r(t,e).length:1)}},"177f":function(t,e,a){"use strict";var r=a("afcd"),n=a.n(r);n.a},"1d6e":function(t,e,a){"use strict";var r=a("abb3"),n=a.n(r);n.a},"214f":function(t,e,a){"use strict";a("b0c5");var r=a("2aba"),n=a("32e9"),s=a("79e5"),i=a("be13"),o=a("2b4c"),c=a("520a"),l=o("species"),u=!s((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),p=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var a="ab".split(t);return 2===a.length&&"a"===a[0]&&"b"===a[1]}();t.exports=function(t,e,a){var d=o(t),f=!s((function(){var e={};return e[d]=function(){return 7},7!=""[t](e)})),h=f?!s((function(){var e=!1,a=/a/;return a.exec=function(){return e=!0,null},"split"===t&&(a.constructor={},a.constructor[l]=function(){return a}),a[d](""),!e})):void 0;if(!f||!h||"replace"===t&&!u||"split"===t&&!p){var g=/./[d],m=a(i,d,""[t],(function(t,e,a,r,n){return e.exec===c?f&&!n?{done:!0,value:g.call(e,a,r)}:{done:!0,value:t.call(a,e,r)}:{done:!1}})),v=m[0],b=m[1];r(String.prototype,t,v),n(RegExp.prototype,d,2==e?function(t,e){return b.call(t,this,e)}:function(t){return b.call(t,this)})}}},"28a5":function(t,e,a){"use strict";var r=a("aae3"),n=a("cb7c"),s=a("ebd6"),i=a("0390"),o=a("9def"),c=a("5f1b"),l=a("520a"),u=a("79e5"),p=Math.min,d=[].push,f="split",h="length",g="lastIndex",m=4294967295,v=!u((function(){RegExp(m,"y")}));a("214f")("split",2,(function(t,e,a,u){var b;return b="c"=="abbc"[f](/(b)*/)[1]||4!="test"[f](/(?:)/,-1)[h]||2!="ab"[f](/(?:ab)*/)[h]||4!="."[f](/(.?)(.?)/)[h]||"."[f](/()()/)[h]>1||""[f](/.?/)[h]?function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!r(t))return a.call(n,t,e);var s,i,o,c=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,f=void 0===e?m:e>>>0,v=new RegExp(t.source,u+"g");while(s=l.call(v,n)){if(i=v[g],i>p&&(c.push(n.slice(p,s.index)),s[h]>1&&s.index<n[h]&&d.apply(c,s.slice(1)),o=s[0][h],p=i,c[h]>=f))break;v[g]===s.index&&v[g]++}return p===n[h]?!o&&v.test("")||c.push(""):c.push(n.slice(p)),c[h]>f?c.slice(0,f):c}:"0"[f](void 0,0)[h]?function(t,e){return void 0===t&&0===e?[]:a.call(this,t,e)}:a,[function(a,r){var n=t(this),s=void 0==a?void 0:a[e];return void 0!==s?s.call(a,n,r):b.call(String(n),a,r)},function(t,e){var r=u(b,t,this,e,b!==a);if(r.done)return r.value;var l=n(t),d=String(this),f=s(l,RegExp),h=l.unicode,g=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(v?"y":"g"),k=new f(v?l:"^(?:"+l.source+")",g),y=void 0===e?m:e>>>0;if(0===y)return[];if(0===d.length)return null===c(k,d)?[d]:[];var w=0,x=0,I=[];while(x<d.length){k.lastIndex=v?x:0;var S,B=c(k,v?d:d.slice(x));if(null===B||(S=p(o(k.lastIndex+(v?0:x)),d.length))===w)x=i(d,x,h);else{if(I.push(d.slice(w,x)),I.length===y)return I;for(var _=1;_<=B.length-1;_++)if(I.push(B[_]),I.length===y)return I;x=w=S}}return I.push(d.slice(w)),I}]}))},3700:function(t,e,a){},"4bb5":function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var r=a("65d9"),n=a("2f62"),s=(i("computed",n["mapState"]),i("computed",n["mapGetters"]));i("methods",n["mapActions"]),i("methods",n["mapMutations"]);function i(t,e){function a(a,n){return Object(r["createDecorator"])((function(r,s){r[t]||(r[t]={});var i,o=(i={},i[s]=a,i);r[t][s]=void 0!==n?e(n,o)[s]:e(o)[s]}))}function n(t,e){if("string"===typeof e){var r=e,n=t;return a(r,void 0)(n,r)}var s=o(e),i=t;return a(i,s)}return n}function o(t){var e=t&&t.namespace;if("string"===typeof e)return"/"!==e[e.length-1]?e+"/":e}},"520a":function(t,e,a){"use strict";var r=a("0bfb"),n=RegExp.prototype.exec,s=String.prototype.replace,i=n,o="lastIndex",c=function(){var t=/a/,e=/b*/g;return n.call(t,"a"),n.call(e,"a"),0!==t[o]||0!==e[o]}(),l=void 0!==/()??/.exec("")[1],u=c||l;u&&(i=function(t){var e,a,i,u,p=this;return l&&(a=new RegExp("^"+p.source+"$(?!\\s)",r.call(p))),c&&(e=p[o]),i=n.call(p,t),c&&i&&(p[o]=p.global?i.index+i[0].length:e),l&&i&&i.length>1&&s.call(i[0],a,(function(){for(u=1;u<arguments.length-2;u++)void 0===arguments[u]&&(i[u]=void 0)})),i}),t.exports=i},"5f1b":function(t,e,a){"use strict";var r=a("23c6"),n=RegExp.prototype.exec;t.exports=function(t,e){var a=t.exec;if("function"===typeof a){var s=a.call(t,e);if("object"!==typeof s)throw new TypeError("RegExp exec method returned something other than an Object or null");return s}if("RegExp"!==r(t))throw new TypeError("RegExp#exec called on incompatible receiver");return n.call(t,e)}},"7f7f":function(t,e,a){var r=a("86cc").f,n=Function.prototype,s=/^\s*function ([^ (]*)/,i="name";i in n||a("9e1e")&&r(n,i,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(t){return""}}})},"803f":function(t,e,a){"use strict";var r=a("e467"),n=a.n(r);n.a},"87ed":function(t,e,a){"use strict";var r=a("c949"),n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/pageQuery",{params:t})},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/inst/query_list",{params:t})},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/pageQuery",{params:t})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/copyBaseBackup",{params:t})},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/deleteBaseBackup",{params:t})},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/callBaseBackup",{params:t})},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/querySettings",{params:t})},p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/unbind",{params:t})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/bind",{params:t})},f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup/saveSettings",t)},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup/recover",t)},g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/list",{params:t})},m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/taskList",{params:t})},v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup/deleteTask",{params:t})};e["a"]={copyBaseBackup:o,delBaseBackup:c,callBaseBackup:l,getOldSetting:u,unbindPg:p,bindBackup:d,saveBackupSet:f,recoverBackup:h,getBackupList:i,getInstanceList:s,getBackupData:g,getBackList:n,getTaskList:m,delTask:v}},aae3:function(t,e,a){var r=a("d3f4"),n=a("2d95"),s=a("2b4c")("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==n(t))}},abb3:function(t,e,a){},afcd:function(t,e,a){},b0c5:function(t,e,a){"use strict";var r=a("520a");a("5ca1")({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},bd39:function(t,e,a){"use strict";var r=a("d81a"),n=a.n(r);n.a},c949:function(t,e,a){"use strict";var r=a("6073"),n=a.n(r),s=n.a.http;e["a"]=s},d48d:function(t,e,a){"use strict";var r=a("3700"),n=a.n(r);n.a},d81a:function(t,e,a){},d9d1:function(t,e,a){},e1ec:function(t,e,a){"use strict";var r=a("c949"),n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/host/list",{params:t})},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/pageQuery",{params:t})},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/list",{params:t})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/delete?backupServerId=".concat(t.backupServerId))},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/restart?backupServerId=".concat(t.backupServerId))},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/stop?backupServerId=".concat(t.backupServerId))},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/start?backupServerId=".concat(t.backupServerId))},p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/versions",{params:t})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/checkConfig",t)},f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].post("/backup_server/create",t)},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/queryBindBackupServer",{params:t})},g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r["a"].get("/backup_server/saveBindRel",{params:t})};e["a"]={getBackList:s,deleteBackup:o,restartBackup:c,stopBackup:l,startBackup:u,getVersion:p,checkBackup:d,createBackup:f,getBackupData:i,getHostList:n,queryBindBackupServer:h,bindBackupServer:g}},e467:function(t,e,a){},e52a:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"parent-style"},[a("div",{staticClass:"headStyle"},[a("el-button",{attrs:{type:"primary"},on:{click:t.createBackup}},[t._v("创建备份")]),a("el-button",{attrs:{type:"primary"},on:{click:t.modifyBackup}},[t._v("修改备份策略")]),a("el-button",{attrs:{type:"primary"},on:{click:t.recoverTimeBackup}},[t._v("恢复到指定时间点")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateBackupServer}},[t._v("绑定备份机")]),a("el-button",{staticStyle:{"margin-bottom":"10px",float:"right"},attrs:{type:"primary"},on:{click:t.refreshPage}},[a("el-tooltip",{attrs:{content:"刷新",placement:"top-start"}},[a("i",{staticClass:"el-icon-refresh-right"})])],1),a("el-popover",{attrs:{placement:"left-start",width:"1000",trigger:"click"},on:{show:t.showPopver}},[a("div",[a("div",{staticClass:"task-style"},[a("el-select",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"请选择操作类型"},on:{change:t.changeTaskType},model:{value:t.operType,callback:function(e){t.operType=e},expression:"operType"}},t._l(t.operTypeList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1),a("el-date-picker",{staticStyle:{"margin-left":"10px"},attrs:{type:"datetimerange","range-separator":"-",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间","picker-options":t.pickerOptions},on:{change:t.pickStatsTime},model:{value:t.resourceTime,callback:function(e){t.resourceTime=e},expression:"resourceTime"}}),a("el-button",{staticStyle:{"margin-bottom":"10px",float:"right"},attrs:{type:"primary"},on:{click:t.refreshTask}},[a("el-tooltip",{attrs:{content:"刷新",placement:"top-start"}},[a("i",{staticClass:"el-icon-refresh-right"})])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadTaskFlag,expression:"loadTaskFlag"}],attrs:{data:t.taskList,"element-loading-text":"加载中"}},[a("el-table-column",{attrs:{label:"操作类型",prop:"operType"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.operType?a("span",[t._v("手动备份")]):t._e(),1==e.row.operType?a("span",[t._v("复制备份")]):t._e(),2==e.row.operType?a("span",[t._v("删除备份")]):t._e(),3==e.row.operType?a("span",[t._v("恢复备份")]):t._e(),4==e.row.operType?a("span",[t._v("自动备份")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"备份ID",prop:"pgBackupBaseInfoId"}}),a("el-table-column",{attrs:{label:"开始时间",prop:"createTimestamp"}}),a("el-table-column",{attrs:{label:"更新时间",prop:"updateTimestamp"}}),a("el-table-column",{attrs:{label:"状态",prop:"statusDesc"},scopedSlots:t._u([{key:"default",fn:function(e){return["失败"==e.row.statusDesc?a("span",[t._v("\n                "+t._s(e.row.statusDesc)+"\n                "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.error,placement:"top-start"}},[a("i",{staticClass:"el-icon-info"})])],1):a("span",[t._v("\n                "+t._s(e.row.statusDesc)+"\n              ")])]}}])})],1),a("div",{staticStyle:{float:"right","margin-top":"10px","margin-bottom":"20px"}},[t.totalTask>5?a("el-pagination",{attrs:{"page-size":t.taskPageSize,"page-sizes":[5],total:t.totalTask,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.onSizeChange,"current-change":t.onCurrentChange}}):t._e()],1)],1),a("el-button",{staticStyle:{float:"right"},attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v("操作列表")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadFlag,expression:"loadFlag"}],attrs:{data:t.backupList,"element-loading-text":"加载中"}},[a("el-table-column",{attrs:{label:"备份名称",prop:"backupName"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.backupName?t._e():a("span",[t._v("--")]),e.row.backupName?a("span",[t._v(t._s(e.row.backupName))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"备份开始时间",sortable:!0,prop:"beginTime"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.beginTime?t._e():a("span",[t._v("--")]),e.row.beginTime?a("span",[t._v(t._s(e.row.beginTime))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"备份结束时间",sortable:!0,prop:"endTime"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.endTime?t._e():a("span",[t._v("--")]),e.row.endTime?a("span",[t._v(t._s(e.row.endTime))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"备份大小",prop:"backupSize","min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.backupSize?t._e():a("span",[t._v("--")]),e.row.backupSize?a("span",[t._v(t._s(t.getfilesize(e.row.backupSize)))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"进度",prop:"process","min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.process?t._e():a("span",[t._v("--")]),e.row.process?a("span",[t._v(t._s(e.row.process)+"%")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"状态",prop:"statusMsg","min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return["失败"==e.row.statusMsg?a("span",[t._v("\n          "+t._s(e.row.statusMsg)+"\n           "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.error,placement:"top-start"}},[a("i",{staticClass:"el-icon-info"})])],1):a("span",[t._v("\n          "+t._s(e.row.statusMsg)+"\n        ")])]}}])}),a("el-table-column",{attrs:{label:"版本",prop:"version","min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.version?t._e():a("span",[t._v("--")]),e.row.version?a("span",[t._v(t._s(e.row.version))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"类型",prop:"backupType",sortable:!0,"min-width":"55"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.backupType?a("span",[t._v("自动")]):t._e(),1==e.row.backupType?a("span",[t._v("手动")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"描述",prop:"remark","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.remark?t._e():a("span",[t._v("--")]),e.row.remark?a("span",[t._v(t._s(e.row.remark))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[-1!=e.row.status?a("el-button",{attrs:{type:"text",loading:e.row.recoverFlag},on:{click:function(a){return t.recoverConfirm(e.row)}}},[t._v(t._s(e.row.recoverFlag?"恢复中":"恢复"))]):t._e(),-1!=e.row.status?a("el-button",{attrs:{type:"text",loading:e.row.copyFlag},on:{click:function(a){return t.copyBackupConfirm(e.row)}}},[t._v(t._s(e.row.copyFlag?"复制中":"复制"))]):t._e(),1==e.row.backupType||-1==e.row.status?a("el-button",{attrs:{type:"text",loading:e.row.delFlag},on:{click:function(a){return t.delBackupConfirm(e.row.pgBackupBaseInfoId,e.row)}}},[t._v(t._s(e.row.delFlag?"删除中":"删除"))]):t._e()]}}])})],1),a("div",{staticStyle:{float:"right","margin-top":"10px","margin-bottom":"20px"}},[t.totalRecord>10?a("el-pagination",{attrs:{"page-size":t.pageSize,total:t.totalRecord,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1),this.showModify?a("modify-backup",{on:{closeList:t.closeList}}):t._e(),this.showTargetTime?a("recover-backup",{on:{closeList:t.closeList}}):t._e(),this.showCreate?a("create-backup",{attrs:{instName:t.instName},on:{closeList:t.closeList}}):t._e(),this.showBind?a("bind-backup",{on:{closeList:t.closeList}}):t._e(),this.showUpdate?a("update-backup",{attrs:{bindServerName:t.bindServerName},on:{closeList:t.closeList}}):t._e(),this.showCopy?a("copy-backup",{attrs:{instName:t.instName,backupInfo:t.backupInfo},on:{closeList:t.closeList}}):t._e(),this.showResume?a("resume-backup",{attrs:{instName:t.instName,backupInfo:t.backupInfo},on:{closeList:t.closeList}}):t._e()],1)},n=[],s=(a("6b54"),a("2397"),a("7f7f"),a("96cf"),a("3b8d")),i=a("d225"),o=a("b0b4"),c=a("308d"),l=a("6bb5"),u=a("4e2b"),p=a("9ab4"),d=a("60a3"),f=a("87ed"),h=a("e1ec"),g=a("4bb5"),m=a("73ec"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"base-dialog",attrs:{title:"修改备份策略",visible:!0,"before-close":t.onCancel,width:"850px"}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingForm,expression:"loadingForm"}],attrs:{"element-loading-text":"正在保存中，请稍候...",model:t.formData,"label-width":"120px",size:"medium"}},[a("el-form-item",{attrs:{label:"开启备份："}},[a("el-radio-group",{model:{value:t.formData.enable,callback:function(e){t.$set(t.formData,"enable",e)},expression:"formData.enable"}},[a("el-radio",{attrs:{label:!0}},[t._v("开启")]),a("el-radio",{attrs:{label:!1}},[t._v("关闭")])],1)],1),a("el-form-item",{attrs:{label:"备份周期："}},[a("el-checkbox-group",{model:{value:t.formData.dayOfWeeks,callback:function(e){t.$set(t.formData,"dayOfWeeks",e)},expression:"formData.dayOfWeeks"}},[a("el-checkbox",{attrs:{label:"1"}},[t._v("星期一")]),a("el-checkbox",{attrs:{label:"2"}},[t._v("星期二")]),a("el-checkbox",{attrs:{label:"3"}},[t._v("星期三")]),a("el-checkbox",{attrs:{label:"4"}},[t._v("星期四")]),a("el-checkbox",{attrs:{label:"5"}},[t._v("星期五")]),a("el-checkbox",{attrs:{label:"6"}},[t._v("星期六")]),a("el-checkbox",{attrs:{label:"7"}},[t._v("星期日")])],1)],1),a("el-form-item",{attrs:{label:"备份开始时间："}},[a("el-time-picker",{attrs:{placeholder:"请选择时间"},model:{value:t.formData.startTime,callback:function(e){t.$set(t.formData,"startTime",e)},expression:"formData.startTime"}})],1),a("el-form-item",{attrs:{label:"全量备份保留："}},[a("el-input-number",{attrs:{"controls-position":"right"},model:{value:t.formData.baseRetainDay,callback:function(e){t.$set(t.formData,"baseRetainDay",e)},expression:"formData.baseRetainDay"}}),t._v("   天\n    ")],1),a("el-form-item",{attrs:{label:"日志备份："}},[a("el-radio-group",{model:{value:t.formData.autoWal,callback:function(e){t.$set(t.formData,"autoWal",e)},expression:"formData.autoWal"}},[a("el-radio",{attrs:{label:!0}},[t._v("开启")]),a("el-radio",{attrs:{label:!1}},[t._v("关闭")])],1)],1),this.formData.autoWal?a("el-form-item",{attrs:{label:"日志备份保留："}},[a("el-input-number",{attrs:{min:this.formData.baseRetainDay,"controls-position":"right"},model:{value:t.formData.walRetainDay,callback:function(e){t.$set(t.formData,"walRetainDay",e)},expression:"formData.walRetainDay"}}),t._v("   天\n    ")],1):t._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("关 闭")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)],1)},b=[];a("ac6a"),a("28a5");function k(t){return function(){var e,a=Object(l["a"])(t);if(y()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var w=function(t){Object(u["a"])(a,t);var e=k(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.oldSetting={},t.loadingForm=!1,t.instId=sessionStorage.getItem("instId")||"",t.backupList=[],t.formData={enable:!0,dayOfWeeks:[],autoWal:!0,baseRetainDay:0,walRetainDay:0,startTime:"",pgBackupServerName:"",pgBackupServerId:""},t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.getOldSetting(),this.getBackList()}},{key:"getOldSetting",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={pgInstId:this.instId},t.next=4,f["a"].getOldSetting(e);case 4:a=t.sent,0==a.data.code&&(this.oldSetting=a.data.data,this.oldSetting?(this.formData.pgBackupServerId=this.oldSetting.pgBackupServerId,this.formData.enable=this.oldSetting.enable,this.formData.dayOfWeeks=this.oldSetting.dayOfWeeks.split(","),this.formData.autoWal=this.oldSetting.autoWal,this.formData.baseRetainDay=this.oldSetting.baseRetainDay,this.formData.walRetainDay=this.oldSetting.walRetainDay,r=this.oldSetting.startTime.split(":"),this.formData.startTime=new Date(2016,9,10,r[0],r[1]),this.formData.pgBackupServerName=this.oldSetting.pgBackupServerName):(this.formData.enable=!1,this.formData.dayOfWeeks=["1","2","3","4","5","6","7"],this.formData.autoWal=!0,this.formData.baseRetainDay=7,this.formData.walRetainDay=7,r=["01","00"],this.formData.startTime=new Date(2016,9,10,r[0],r[1]))),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,this,[[0,8,10,12]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"formatDate",value:function(t){var e=new Date(t),a=this.p(e.getHours())+":"+this.p(e.getMinutes());return a}},{key:"p",value:function(t){return t<10?"0"+t:t}},{key:"onCancel",value:function(){this.$emit("closeList")}},{key:"getBackList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={name:"",pageNow:1,pageSize:100},t.next=4,f["a"].getBackList(e);case 4:a=t.sent,0===a.data.code?a.data.data.list.forEach((function(t){r.backupList.push({pgBackupServerId:t.pgBackupServerId,name:t.name})})):this.$message.warning("获取数据失败，".concat(a.data.msg)),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,this,[[0,8,10,12]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"unbind",value:function(){var t=this;this.$confirm("是否确认解绑？","解绑备份机",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.unbindPg()})).catch((function(){}))}},{key:"unbindPg",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,{pgInstId:this.instId},t.next=4,f["a"].unbindPg();case 4:e=t.sent,0==e.data.code?this.$message.success("解绑成功"):this.$message.warning("解绑失败，".concat(e.data.msg)),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),this.$message.warning("解绑失败，".concat(t.t0));case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"bindBackup",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={pgInstId:this.instId,backupServerId:this.formData.pgBackupServerId},t.next=4,f["a"].bindBackup(e);case 4:t.sent,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,this,[[0,7]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e="",this.formData.dayOfWeeks.forEach((function(t){e+=t+","})),e=e.substring(0,e.length-1),a=null,this.oldSetting&&(a=this.oldSetting.pgBackupSetttingId),!(this.formData.walRetainDay<this.formData.baseRetainDay)){t.next=10;break}this.$message.warning("日志备份保留天数需大于全量备份保留天数"),t.next=16;break;case 10:return this.loadingForm=!0,r={pgBackupSetttingId:a,pgBackupServerId:this.formData.pgBackupServerId,autoWal:this.formData.autoWal,baseRetainDay:this.formData.baseRetainDay,dayOfWeeks:e,enable:this.formData.enable,walRetainDay:this.formData.walRetainDay,startTime:this.formatDate(this.formData.startTime),pgInstId:this.instId},t.next=14,f["a"].saveBackupSet(r);case 14:n=t.sent,0==n.data.code?(this.$message.success("修改成功"),this.loadingForm=!1,this.onCancel()):(this.$message.warning("修改失败，".concat(n.data.msg)),this.loadingForm=!1);case 16:t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),this.$message.warning("修改失败，".concat(t.t0)),this.loadingForm=!1;case 22:case"end":return t.stop()}}),t,this,[[0,18]])})));function e(){return t.apply(this,arguments)}return e}()}]),a}(d["c"]);Object(p["a"])([Object(g["a"])("data/getData")],w.prototype,"data",void 0),w=Object(p["a"])([d["a"]],w);var x=w,I=x,S=(a("177f"),a("2877")),B=Object(S["a"])(I,v,b,!1,null,"c83d7864",null),_=B.exports,D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"base-dialog",attrs:{title:"恢复到指定时间点",visible:!0,"before-close":t.onCancel,width:"500px"}},[a("p",{staticStyle:{padding:"10px 100px"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"30px",color:"red","margin-right":"10px"}}),a("span",{staticStyle:{"font-size":"20px","font-weight":"500"}},[t._v("是否确认恢复？")])]),a("div",{staticStyle:{margin:"0px 10px 40px 10px"}},[t._v("此恢复为覆盖性恢复，会删除原始数据，恢复前请确保已做好数据备份")]),a("el-form",{attrs:{model:t.formData,"label-width":"120px","v-loading":t.loadingForm}},[a("el-form-item",{attrs:{label:"恢复的时间点："}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择选择日期时间"},model:{value:t.formData.targetTime,callback:function(e){t.$set(t.formData,"targetTime",e)},expression:"formData.targetTime"}})],1),a("el-form-item",{attrs:{label:"恢复的目标实例："}},[a("el-radio-group",{model:{value:t.formData.targetInst,callback:function(e){t.$set(t.formData,"targetInst",e)},expression:"formData.targetInst"}},[a("el-radio-button",{attrs:{label:"当前实例"}}),a("el-radio-button",{attrs:{label:"指定实例"}})],1)],1),"指定实例"==t.formData.targetInst?a("el-form-item",{staticClass:"select-style",attrs:{label:"目标实例："}},[a("el-select",{attrs:{placeholder:"请选择实例"},on:{change:t.changeInst},model:{value:t.destPgInstId,callback:function(e){t.destPgInstId=e},expression:"destPgInstId"}},t._l(t.instList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1):t._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)],1)},T=[];function O(t){return function(){var e,a=Object(l["a"])(t);if(R()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function R(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var j=function(t){Object(u["a"])(a,t);var e=O(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.instId=sessionStorage.getItem("instId")||"",t.formData={targetTime:"",targetInst:"当前实例"},t.loadingForm=!1,t.destPgInstId="",t.instList=[],t.selesctValue=JSON.parse(sessionStorage.getItem("tableData")||""),t}return Object(o["a"])(a,[{key:"mounted",value:function(){var t=this;this.selesctValue.forEach((function(e){t.instList.push({value:e.instId,label:e.instName})}))}},{key:"onCancel",value:function(){this.$emit("closeList")}},{key:"changeInst",value:function(t){this.destPgInstId=t}},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.loadingForm=!0,""!=this.formData.targetTime){t.next=5;break}this.$message.warning("请选择要恢复的时间点"),t.next=22;break;case 5:return e=new Date(this.formData.targetTime).getTime(),a={},"当前实例"==this.formData.targetInst?a={destPgInstId:this.instId,srcPgInstId:this.instId,targetTimestamp:e}:"指定实例"==this.formData.targetInst&&(a={destPgInstId:this.destPgInstId,srcPgInstId:this.instId,targetTimestamp:e}),t.prev=8,t.next=11,f["a"].recoverBackup(a);case 11:r=t.sent,0==r.data.code?(this.$message.success("任务已经发送到后台运行，请稍后查看"),this.loadingForm=!1,this.onCancel()):(this.$message.warning("恢复失败，".concat(r.data.msg)),this.loadingForm=!1,this.onCancel()),t.next=20;break;case 15:t.prev=15,t.t0=t["catch"](8),this.$message.warning("恢复失败,".concat(t.t0)),this.loadingForm=!1,this.onCancel();case 20:return t.prev=20,t.finish(20);case 22:case"end":return t.stop()}}),t,this,[[8,15,20,22]])})));function e(){return t.apply(this,arguments)}return e}()}]),a}(d["c"]);Object(p["a"])([Object(g["a"])("data/getData")],j.prototype,"data",void 0),j=Object(p["a"])([d["a"]],j);var C=j,L=C,F=(a("bd39"),Object(S["a"])(L,D,T,!1,null,"fc225f7c",null)),$=F.exports,N=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"base-dialog",attrs:{title:"创建备份",visible:!0,"before-close":t.onCancel,width:"600px"}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"100px",rules:t.rules,"v-loading":t.loadingForm}},[a("el-form-item",{attrs:{label:"实例名称:"}},[a("p",[t._v(t._s(t.instName))])]),a("el-form-item",{attrs:{label:"备份名称:",prop:"backupName"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入备份名称"},model:{value:t.formData.backupName,callback:function(e){t.$set(t.formData,"backupName",e)},expression:"formData.backupName"}})],1),a("el-form-item",{attrs:{label:"描述:"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{type:"textarea",rows:5,maxlength:"256","show-word-limit":"",placeholder:"请输入备份描述"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)],1)},P=[];function z(t){return function(){var e,a=Object(l["a"])(t);if(E()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var M=function(t){Object(u["a"])(a,t);var e=z(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.instId=sessionStorage.getItem("instId")||"",t.formData={},t.loadingForm=!1,t.rules={backupName:[{required:!0,message:"请输入备份名称",trigger:"blur"}]},t}return Object(o["a"])(a,[{key:"mounted",value:function(){}},{key:"onCancel",value:function(){this.$emit("closeList")}},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingForm=!0,e={instId:this.instId,backupName:this.formData.backupName,remark:this.formData.remark},t.prev=2,t.next=5,this.$refs.form.validate();case 5:return t.next=7,f["a"].callBaseBackup(e);case 7:a=t.sent,0==a.data.code?(this.loadingForm=!1,this.$message.success("创建成功"),this.onCancel()):(this.$message.error("创建失败,".concat(a.data.msg)),this.loadingForm=!1,this.onCancel()),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),this.loadingForm=!1;case 14:return t.prev=14,t.finish(14);case 16:case"end":return t.stop()}}),t,this,[[2,11,14,16]])})));function e(){return t.apply(this,arguments)}return e}()}]),a}(d["c"]);Object(p["a"])([Object(d["b"])(String)],M.prototype,"instName",void 0),Object(p["a"])([Object(g["a"])("data/getData")],M.prototype,"data",void 0),M=Object(p["a"])([d["a"]],M);var W=M,q=W,H=Object(S["a"])(q,N,P,!1,null,"56eaef10",null),V=H.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingForm,expression:"loadingForm"}],staticClass:"base-dialog",attrs:{title:"绑定备份机",visible:!0,"before-close":t.onCancel,width:"500px"}},[a("p",{staticClass:"tipStyle"},[t._v("该实例暂未绑定备份机，请先绑定备份机")]),a("div",{staticClass:"select-style"},[a("span",{staticStyle:{"margin-left":"30px"}},[t._v("绑定备份机：")]),a("el-select",{attrs:{placeholder:""},model:{value:t.pgBackupServerId,callback:function(e){t.pgBackupServerId=e},expression:"pgBackupServerId"}},t._l(t.backupList,(function(t){return a("el-option",{key:t.pgBackupServerId,attrs:{label:t.name,value:t.pgBackupServerId}})})),1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)])},J=[];function U(t){return function(){var e,a=Object(l["a"])(t);if(Q()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function Q(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var G=function(t){Object(u["a"])(a,t);var e=U(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.loadingForm=!1,t.instId=sessionStorage.getItem("instId")||"",t.pgBackupServerId="",t.backupList=[],t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.getBackupList()}},{key:"getBackupList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={name:"",pageNow:1,pageSize:100},t.next=4,f["a"].getBackList(e);case 4:a=t.sent,0===a.data.code?a.data.data.list.forEach((function(t){r.backupList.push({pgBackupServerId:t.pgBackupServerId,name:t.name})})):this.$message.warning("获取数据失败，".concat(a.data.msg)),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,this,[[0,8,10,12]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingForm=!0,e={backupServerId:this.pgBackupServerId,pgInstId:this.instId},t.prev=2,t.next=5,h["a"].bindBackupServer(e);case 5:a=t.sent,0===a.data.code?(this.$message.success("绑定备份机成功"),this.$emit("closeList"),this.loadingForm=!1):(this.$message.error("绑定备份机失败，".concat(a.data.msg)),this.$emit("closeList"),this.loadingForm=!1),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](2),this.$message.error("绑定备份机失败，".concat(t.t0)),this.$emit("closeList"),this.loadingForm=!1;case 14:return t.prev=14,t.finish(14);case 16:case"end":return t.stop()}}),t,this,[[2,9,14,16]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onCancel",value:function(){this.$emit("closeList")}}]),a}(d["c"]);Object(p["a"])([Object(g["a"])("data/getData")],G.prototype,"data",void 0),G=Object(p["a"])([d["a"]],G);var K=G,Y=K,X=(a("803f"),Object(S["a"])(Y,A,J,!1,null,"46ded9e3",null)),Z=X.exports,tt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingForm,expression:"loadingForm"}],staticClass:"base-dialog",attrs:{title:"绑定备份机",visible:!0,"before-close":t.onCancel,width:"500px"}},[a("p",{staticClass:"tipStyle"},[t._v("当前实例的历史备份信息保留在旧备机实例，如变更绑定备份机则无法恢复历史备份")]),a("div",{staticClass:"select-style "},[a("p",{staticStyle:{"margin-bottom":"20px"}},[a("span",[t._v("当前绑定备份机：")]),a("span",[t._v(t._s(t.bindServerName))])]),a("span",{directives:[{name:"loading",rawName:"v-loading"}],staticStyle:{"margin-left":"15px"}},[t._v("绑定新备份机：")]),a("el-select",{attrs:{placeholder:""},model:{value:t.pgBackupServerId,callback:function(e){t.pgBackupServerId=e},expression:"pgBackupServerId"}},t._l(t.backupList,(function(t){return a("el-option",{key:t.pgBackupServerId,attrs:{label:t.name,value:t.pgBackupServerId}})})),1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)])},et=[];function at(t){return function(){var e,a=Object(l["a"])(t);if(rt()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function rt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var nt=function(t){Object(u["a"])(a,t);var e=at(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.loadingForm=!1,t.instId=sessionStorage.getItem("instId")||"",t.pgBackupServerId="",t.backupList=[],t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.getBackupList()}},{key:"getBackupList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={name:"",pageNow:1,pageSize:100},t.next=4,f["a"].getBackList(e);case 4:a=t.sent,0===a.data.code?a.data.data.list.forEach((function(t){r.backupList.push({pgBackupServerId:t.pgBackupServerId,name:t.name})})):this.$message.warning("获取数据失败，".concat(a.data.msg)),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:return t.prev=10,t.finish(10);case 12:case"end":return t.stop()}}),t,this,[[0,8,10,12]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingForm=!0,e={backupServerId:this.pgBackupServerId,pgInstId:this.instId},t.prev=2,t.next=5,h["a"].bindBackupServer(e);case 5:a=t.sent,0===a.data.code?(this.$message.success("绑定备份机成功"),this.$emit("closeList"),this.loadingForm=!1):(this.$message.error("绑定备份机失败，".concat(a.data.msg)),this.$emit("closeList"),this.loadingForm=!1),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](2),this.$message.error("绑定备份机失败，".concat(t.t0)),this.$emit("closeList"),this.loadingForm=!1;case 14:return t.prev=14,t.finish(14);case 16:case"end":return t.stop()}}),t,this,[[2,9,14,16]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onCancel",value:function(){this.$emit("closeList")}}]),a}(d["c"]);Object(p["a"])([Object(d["b"])(String)],nt.prototype,"bindServerName",void 0),Object(p["a"])([Object(g["a"])("data/getData")],nt.prototype,"data",void 0),nt=Object(p["a"])([d["a"]],nt);var st=nt,it=st,ot=(a("1d6e"),Object(S["a"])(it,tt,et,!1,null,"399056e6",null)),ct=ot.exports,lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"base-dialog",attrs:{title:"复制备份",visible:!0,"before-close":t.onCancel,width:"600px"}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"100px",rules:t.rules,"v-loading":t.loadingForm}},[a("el-form-item",{attrs:{label:"实例名称:"}},[a("p",[t._v(t._s(t.instName))])]),a("el-form-item",{attrs:{label:"备份名称:",prop:"backupName"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入备份名称"},model:{value:t.formData.backupName,callback:function(e){t.$set(t.formData,"backupName",e)},expression:"formData.backupName"}})],1),a("el-form-item",{attrs:{label:"描述:"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{type:"textarea",rows:5,maxlength:"256","show-word-limit":"",placeholder:"请输入备份描述"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)],1)},ut=[];function pt(t){return function(){var e,a=Object(l["a"])(t);if(dt()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function dt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var ft=function(t){Object(u["a"])(a,t);var e=pt(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.instId=sessionStorage.getItem("instId")||"",t.formData={backupName:"",remark:""},t.loadingForm=!1,t.rules={backupName:[{required:!0,message:"请输入备份名称",trigger:"blur"}]},t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.formData.backupName=this.backupInfo.backupName+"-backup"}},{key:"onCancel",value:function(){this.$emit("closeList")}},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingForm=!0,e={pgBaseBackupInfoId:this.backupInfo.pgBackupBaseInfoId,backupName:this.formData.backupName,remark:this.formData.remark},t.prev=2,t.next=5,this.$refs.form.validate();case 5:return t.next=7,f["a"].copyBaseBackup(e);case 7:a=t.sent,0==a.data.code?(this.loadingForm=!1,this.$message.success("任务已经发送到后台运行，请稍后查看"),this.onCancel()):(this.$message.error("复制失败,".concat(a.data.msg)),this.loadingForm=!1,this.onCancel()),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),this.loadingForm=!1;case 14:return t.prev=14,t.finish(14);case 16:case"end":return t.stop()}}),t,this,[[2,11,14,16]])})));function e(){return t.apply(this,arguments)}return e}()}]),a}(d["c"]);Object(p["a"])([Object(d["b"])(String)],ft.prototype,"instName",void 0),Object(p["a"])([Object(d["b"])(Object)],ft.prototype,"backupInfo",void 0),Object(p["a"])([Object(g["a"])("data/getData")],ft.prototype,"data",void 0),ft=Object(p["a"])([d["a"]],ft);var ht=ft,gt=ht,mt=Object(S["a"])(gt,lt,ut,!1,null,"99076580",null),vt=mt.exports,bt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"base-dialog",attrs:{title:"恢复备份",visible:!0,"before-close":t.onCancel,width:"500px"}},[a("p",{staticStyle:{padding:"10px 100px"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{"font-size":"30px",color:"red","margin-right":"10px"}}),a("span",{staticStyle:{"font-size":"20px","font-weight":"500"}},[t._v("是否确认恢复？")])]),a("div",{staticStyle:{margin:"0px 10px 40px 10px"}},[t._v("此恢复为覆盖性恢复，会删除原始数据，恢复前请确保已做好数据备份")]),a("el-form",{attrs:{model:t.formData,"label-width":"120px","v-loading":t.loadingForm}},[a("el-form-item",{attrs:{label:"当前实例："}},[a("p",[t._v(t._s(t.instName))])]),a("el-form-item",{attrs:{label:"恢复的目标实例："}},[a("el-radio-group",{model:{value:t.formData.targetInst,callback:function(e){t.$set(t.formData,"targetInst",e)},expression:"formData.targetInst"}},[a("el-radio-button",{attrs:{label:"当前实例"}}),a("el-radio-button",{attrs:{label:"指定实例"}})],1)],1),"指定实例"==t.formData.targetInst?a("el-form-item",{staticClass:"select-style",attrs:{label:"目标实例："}},[a("el-select",{attrs:{placeholder:"请选择实例"},on:{change:t.changeInst},model:{value:t.destPgInstId,callback:function(e){t.destPgInstId=e},expression:"destPgInstId"}},t._l(t.instList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1):t._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.loadingForm},on:{click:t.onSave}},[t._v("确 定")])],1)],1)},kt=[];function yt(t){return function(){var e,a=Object(l["a"])(t);if(wt()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function wt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var xt=function(t){Object(u["a"])(a,t);var e=yt(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.instId=sessionStorage.getItem("instId")||"",t.formData={targetTime:"",targetInst:"当前实例"},t.loadingForm=!1,t.destPgInstId="",t.instList=[],t.selesctValue=JSON.parse(sessionStorage.getItem("tableData")||""),t}return Object(o["a"])(a,[{key:"mounted",value:function(){var t=this;this.selesctValue.forEach((function(e){t.instList.push({value:e.instId,label:e.instName})}))}},{key:"onCancel",value:function(){this.$emit("closeList")}},{key:"changeInst",value:function(t){this.destPgInstId=t}},{key:"onSave",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadingForm=!0,new Date(this.formData.targetTime).getTime(),e={},"当前实例"==this.formData.targetInst?e={destPgInstId:this.instId,srcPgInstId:this.instId,pgBaseBackupInfoId:this.backupInfo.pgBackupBaseInfoId}:"指定实例"==this.formData.targetInst&&(e={destPgInstId:this.destPgInstId,srcPgInstId:this.instId,pgBaseBackupInfoId:this.backupInfo.pgBackupBaseInfoId}),t.prev=4,t.next=7,f["a"].recoverBackup(e);case 7:a=t.sent,0==a.data.code?(this.$message.success("任务已经发送到后台运行，请稍后查看"),this.loadingForm=!1,this.onCancel()):(this.$message.warning("恢复失败，".concat(a.data.msg)),this.loadingForm=!1,this.onCancel()),t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](4),this.$message.warning("恢复失败,".concat(t.t0)),this.loadingForm=!1,this.onCancel();case 16:return t.prev=16,t.finish(16);case 18:case"end":return t.stop()}}),t,this,[[4,11,16,18]])})));function e(){return t.apply(this,arguments)}return e}()}]),a}(d["c"]);Object(p["a"])([Object(g["a"])("data/getData")],xt.prototype,"data",void 0),Object(p["a"])([Object(d["b"])(Object)],xt.prototype,"backupInfo",void 0),Object(p["a"])([Object(d["b"])(String)],xt.prototype,"instName",void 0),xt=Object(p["a"])([d["a"]],xt);var It=xt,St=It,Bt=(a("d48d"),Object(S["a"])(St,bt,kt,!1,null,"20efa63c",null)),_t=Bt.exports;function Dt(t){return function(){var e,a=Object(l["a"])(t);if(Tt()){var r=Object(l["a"])(this).constructor;e=Reflect.construct(a,arguments,r)}else e=a.apply(this,arguments);return Object(c["a"])(this,e)}}function Tt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var Ot=function(t){Object(u["a"])(a,t);var e=Dt(a);function a(){var t;return Object(i["a"])(this,a),t=e.apply(this,arguments),t.rowData={},t.taskList=[],t.totalRecord=0,t.pageSize=10,t.pageIndex=1,t.instId=sessionStorage.getItem("instId")||"",t.instName=sessionStorage.getItem("instName")||"",t.type="",t.loadFlag=!1,t.backupList=[],t.showCreate=!1,t.showBind=!1,t.bindServerName="",t.resourceTime=[],t.showResume=!1,t.pickerOptions={shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},t.typeList=[{label:"自动",value:0},{label:"手动",value:1}],t.startTime="",t.endTime="",t.copyFlag=!1,t.delFlag=!1,t.instMapList=[],t.createFlag=!1,t.showModify=!1,t.recoverFlag=!1,t.showTargetTime=!1,t.stopFlag=!1,t.isBind=!1,t.showUpdate=!1,t.showCopy=!1,t.backupInfo={},t.loopBackList=null,t.operTypeList=[{label:"手动备份",value:0},{label:"复制备份",value:1},{label:"删除备份",value:2},{label:"恢复备份",value:3},{label:"自动备份",value:4}],t.statusTypeList=[{label:"完成",value:2},{label:"运行中",value:1},{label:"失败",value:-1},{label:"开始",value:0}],t.taskPageNow=1,t.taskPageSize=5,t.operType="",t.totalTask=0,t.taskStatus="",t.loadTaskFlag=!1,t}return Object(o["a"])(a,[{key:"mounted",value:function(){this.getBackupList(),this.getTaskList(),this.isBindBackupServer();var t=this;m["bus"].$on("test",(function(e){t.loadFlag=!0,t.instId=e,t.getBackupList(),t.getTaskList(),t.isBindBackupServer(),t.instName=sessionStorage.getItem("instName")||""}))}},{key:"isBindBackupServer",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={pgInstId:this.instId},t.prev=1,t.next=4,h["a"].queryBindBackupServer(e);case 4:a=t.sent,0==a.data.code&&(a.data.data?(this.isBind=!0,this.bindServerName=a.data.data.name):this.isBind=!1),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:case"end":return t.stop()}}),t,this,[[1,8]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"changeType",value:function(t){this.type=t,this.getBackupList()}},{key:"modifyBackup",value:function(){this.showModify=!0}},{key:"closeList",value:function(){this.showModify=!1,this.showTargetTime=!1,this.showCreate=!1,this.showBind=!1,this.showUpdate=!1,this.showCopy=!1,this.showResume=!1,this.getBackupList(),this.isBindBackupServer()}},{key:"createBackup",value:function(){this.isBind?this.showCreate=!0:this.showBind=!0}},{key:"updateBackupServer",value:function(){this.isBind?this.showUpdate=!0:this.showBind=!0}},{key:"copyBackupConfirm",value:function(t){this.isBind?(this.showCopy=!0,this.backupInfo=t):this.showBind=!0}},{key:"delBackupConfirm",value:function(t,e){var a=this;this.isBind?this.$confirm("是否删除该备份？","删除备份",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.delFlag=!0,a.delBaseBackup(t,e)})).catch((function(){})):this.showBind=!0}},{key:"delBaseBackup",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r={pgBaseBackupInfoId:e},t.next=4,f["a"].delBaseBackup(r);case 4:n=t.sent,0==n.data.code?(this.$message.success("任务已经发送到后台运行，请稍后查看"),a.delFlag=!1,this.getBackupList()):(this.$message.warning("删除失败，".concat(n.data.msg)),a.delFlag=!1),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),this.$message.warning("删除失败,".concat(t.t0)),a.delFlag=!1;case 12:return t.prev=12,t.finish(12);case 14:case"end":return t.stop()}}),t,this,[[0,8,12,14]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"recoverConfirm",value:function(t){this.isBind?(this.showResume=!0,this.backupInfo=t):this.showBind=!0}},{key:"recoverBackup",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a,r){var n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={destPgInstId:e,srcPgInstId:e,pgBaseBackupInfoId:a},t.next=4,f["a"].recoverBackup(n);case 4:s=t.sent,0==s.data.code?(this.$message.success("任务已经发送到后台运行，请稍后查看"),r.recoverFlag=!1,this.getBackupList()):(this.$message.warning("恢复失败，".concat(s.data.msg)),r.recoverFlag=!1),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),this.$message.warning("恢复失败,".concat(t.t0)),r.recoverFlag=!1;case 12:return t.prev=12,t.finish(12);case 14:case"end":return t.stop()}}),t,this,[[0,8,12,14]])})));function e(e,a,r){return t.apply(this,arguments)}return e}()},{key:"recoverTimeBackup",value:function(){this.isBind?this.showTargetTime=!0:this.showBind=!0}},{key:"getBackupList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a,r,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadFlag=!0,t.prev=1,e={instId:this.instId,type:this.type,startTime:this.startTime,endTime:this.endTime,pageNow:this.pageIndex,pageSize:this.pageSize},t.next=5,f["a"].getBackupList(e);case 5:if(a=t.sent,0===a.data.code){for(this.loadFlag=!1,this.backupList=a.data.data.list,this.backupList.length&&this.backupList.map((function(t){return n.$set(t,"copyFlag",!1),n.$set(t,"recoverFlag",!1),n.$set(t,"delFlag",!1),t})),r=0;r<this.backupList.length;r++)-1!=this.backupList[r].status&&99!=this.backupList[r].status&&setTimeout(this.getBackupList,5e3);this.totalRecord=a.data.data.total}else this.loadFlag=!1,this.$message.warning("获取数据失败，".concat(a.data.msg));t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](1);case 11:return t.prev=11,t.finish(11);case 13:case"end":return t.stop()}}),t,this,[[1,9,11,13]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"getfilesize",value:function(t){if(!t)return"";var e=1024;return t<e?t+"B":t<Math.pow(e,2)?(t/e).toFixed(2)+"K":t<Math.pow(e,3)?(t/Math.pow(e,2)).toFixed(2)+"M":t<Math.pow(e,4)?(t/Math.pow(e,3)).toFixed(2)+"G":(t/Math.pow(e,4)).toFixed(2)+"T"}},{key:"refreshPage",value:function(){this.getBackupList()}},{key:"handleSizeChange",value:function(t){this.pageSize=t,this.getBackupList()}},{key:"handleCurrentChange",value:function(t){this.pageIndex=t,this.getBackupList()}},{key:"pickStatsTime",value:function(t){this.resourceTime=t,this.startTime=new Date(this.resourceTime[0]).getTime(),this.endTime=new Date(this.resourceTime[1]).getTime(),this.getTaskList()}},{key:"changeTaskType",value:function(t){this.operType=t,this.getTaskList()}},{key:"changeTaskStatus",value:function(t){this.taskStatus=t,this.getTaskList()}},{key:"refreshTask",value:function(){this.operType="",this.taskStatus="",this.resourceTime=[],this.getTaskList()}},{key:"getTaskList",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadTaskFlag=!0,e={instId:this.instId,operType:this.operType,pageNow:this.taskPageNow,pageSize:this.taskPageSize,startTime:this.startTime,endTime:this.endTime},t.prev=2,t.next=5,f["a"].getTaskList(e);case 5:a=t.sent,0==a.data.code?(this.taskList=a.data.data.list,this.totalTask=a.data.data.total,this.loadTaskFlag=!1):(this.$message.error("获取操作列表失败"),this.loadTaskFlag=!1),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),this.$message.error("获取操作列表失败"),this.loadTaskFlag=!1;case 13:case"end":return t.stop()}}),t,this,[[2,9]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"delTaskConfirm",value:function(t){var e=this;this.$confirm("是否确认删除该任务? ","删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.delTask(t)})).catch((function(){}))}},{key:"delTask",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={pgBackupTaskId:e},t.next=4,f["a"].delTask(a);case 4:r=t.sent,0==r.data.code?(this.$message.success("删除任务成功"),this.getTaskList()):this.$message.error("删除任务失败,".concat(r.data.msg)),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),this.$message.error("删除任务失败,".concat(t.t0));case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"copyClipboard",value:function(t){var e=this;this.$copyText(t).then((function(t){e.$message({showClose:!0,message:"复制成功",type:"success"})}),(function(t){e.$message({showClose:!0,message:"复制失败，请手动复制",type:"error"})}))}},{key:"onSizeChange",value:function(t){this.taskPageSize=t,this.getTaskList()}},{key:"onCurrentChange",value:function(t){this.taskPageNow=t,this.getTaskList()}},{key:"showPopver",value:function(){this.getTaskList()}},{key:"formatDate",value:function(t){var e=new Date(t),a=e.getFullYear()+"-"+this.p(e.getMonth()+1)+"-"+this.p(e.getDate()),r=this.p(e.getHours())+":"+this.p(e.getMinutes())+":"+this.p(e.getSeconds());return a+" "+r}},{key:"p",value:function(t){return t<10?"0"+t:t}}]),a}(d["c"]);Object(p["a"])([Object(g["a"])("data/getData")],Ot.prototype,"data",void 0),Ot=Object(p["a"])([Object(d["a"])({components:{modifyBackup:_,recoverBackup:$,createBackup:V,bindBackup:Z,updateBackup:ct,copyBackup:vt,resumeBackup:_t}})],Ot);var Rt=Ot,jt=Rt,Ct=(a("f204"),Object(S["a"])(jt,r,n,!1,null,"489fc107",null));e["default"]=Ct.exports},f204:function(t,e,a){"use strict";var r=a("d9d1"),n=a.n(r);n.a}}]);